---
import StepCard from "../ui/StepCard.astro";

const steps = [
  {
    step: 1,
    title: "Connect Your Accounts",
    description:
      "Link your Google and Meta accounts in 60 seconds. We handle the rest.",
  },
  {
    step: 2,
    title: "Let AI Learn Your Brand",
    description:
      "Our AI analyzes your existing content to match your unique voice and style.",
  },
  {
    step: 3,
    title: "Create, Schedule, Grow",
    description:
      "Generate content, automate responses, and watch your presence amplify.",
  },
];
---

<section id="how-it-works" class="relative section-padding bg-background overflow-hidden">
  <div class="container-marketing">
    <!-- Section Header -->
    <div class="text-center max-w-2xl mx-auto mb-12 md:mb-16" data-reveal>
      <h2 class="font-display text-3xl md:text-4xl lg:text-5xl font-bold tracking-tight text-foreground mb-4">
        Get started in
        <span class="text-gradient-primary">three steps</span>
      </h2>
      <p class="text-lg text-muted-foreground">
        From signup to first post in under 5 minutes. No complex setup, no
        learning curve.
      </p>
    </div>

    <!-- Steps Timeline -->
    <div class="relative">
      <!-- Connection Line (Desktop) -->
      <div class="hidden md:block absolute top-6 left-0 right-0 h-px bg-border"></div>
      <div class="hidden md:block absolute top-6 left-0 h-px bg-gradient-to-r from-primary to-accent w-0 transition-all duration-1000" data-progress-line></div>

      <!-- Steps Grid -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12">
        {
          steps.map((step, index) => (
            <div class="relative" data-reveal data-delay={String(index + 1)}>
              <!-- Mobile connection line -->
              {index < steps.length - 1 && (
                <div class="md:hidden absolute left-6 top-12 bottom-0 w-px bg-border -mb-8"></div>
              )}
              <StepCard
                step={step.step}
                title={step.title}
                description={step.description}
              />
            </div>
          ))
        }
      </div>
    </div>

    <!-- Bottom CTA -->
    <div class="text-center mt-12 md:mt-16" data-reveal data-delay="4">
      <p class="text-muted-foreground mb-4">
        Ready to amplify your presence?
      </p>
      <a
        href="/signup"
        class="inline-flex items-center px-6 py-3 text-base font-medium rounded-md bg-primary text-primary-foreground shadow-hard-sm hover:-translate-y-0.5 hover:translate-x-0.5 active:translate-y-0 active:translate-x-0 active:shadow-none transition-all"
      >
        Start Free Trial
        <svg
          class="w-4 h-4 ml-2"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path d="M5 12h14M12 5l7 7-7 7"></path>
        </svg>
      </a>
    </div>
  </div>
</section>

<script>
  function animateProgressLine() {
    const line = document.querySelector('[data-progress-line]') as HTMLElement;
    if (!line) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            line.style.width = '100%';
            // Disconnect observer after animation triggers to prevent memory leak
            observer.disconnect();
          }
        });
      },
      { threshold: 0.5 }
    );

    observer.observe(line.parentElement!);
  }

  animateProgressLine();
  document.addEventListener('astro:page-load', animateProgressLine);
</script>
